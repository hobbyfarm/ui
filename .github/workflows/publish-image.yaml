name: publish image
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 2
    - name: tag version if bumped
      run: |
        if git diff HEAD~1 package.json | grep '"version":'; then
          version="$(cat package.json | jq -r '.version')"
          git tag $version
          git push origin $version
        fi
    - name: publish to registry
      uses: elgohr/Publish-Docker-Github-Action@2.11
      with:
          name: ${{ github.repository }}
          username: ${{ secrets.REGISTRY_USER }}
          password: ${{ secrets.REGISTRY_PASSWORD }}
          tag_names: true
