<pre class="quiz-container">
  @if (quizTitle) { <h5 class="quiz-title">{{ quizTitle }}</h5> }

  @if(isPersistent && !loadingQuiz && !currentQuiz) {
    <clr-alert
      [clrAlertType]="'danger'"
      [clrAlertClosable]="false"
    >
      <clr-alert-item>
        <span class="alert-text">
          Failed to load quiz!
        </span>
      </clr-alert-item>
    </clr-alert>
  }
  @else if (isPersistent && alreadyPassed) {
    <alert #failedDownloadAlert></alert>
    <clr-alert
      [clrAlertType]="'success'"
      [clrAlertClosable]="false"
      [clrAlertIcon]="'check-circle'"
    >
      <clr-alert-item class="centered">
        <span class="alert-text">
          You passed this quiz. Great job!
        </span>
        @if(quizIssuer) {
          <div class="alert-actions">
            <button class="btn alert-action" (click)="download()">Download Certificate</button>
          </div>
        }
      </clr-alert-item>
    </clr-alert>
  } @else if(isPersistent && loadingQuestions && started) {
    <span class="spinner spinner-inline"> Loading... </span>
    <span> Loading Questions... </span>
  } @else if (!isPersistent || isPersistent && !alreadyPassed && started) { 
    @for (q of questions; track q.id || q.title; let i = $index) {
      @if (q.type === 'checkbox') {
        <quiz-checkbox
          [quizId]="quizId"
          [scenarioId]="scenarioId"
          [questionId]="q.id || ''"
          [title]="q.title"
          [helperText]="q.helperText || ''"
          [validation]="q.validation"
          [successMsg]="q.successMsg"
          [errMsg]="q.errorMsg"
          [shuffle]="q.shuffle"
          [questionAnswers]="q.answers"
          [correctAnswerIds]="correctIdsByQid.get(q.id ?? '') ?? testObs"
          [remotePass]="remotePass"
        ></quiz-checkbox>
      } @else {
        <quiz-radio
          [quizId]="quizId"
          [scenarioId]="scenarioId"
          [questionId]="q.id || ''"
          [title]="q.title"
          [helperText]="q.helperText || ''"
          [validation]="q.validation"
          [successMsg]="q.successMsg"
          [errMsg]="q.errorMsg"
          [shuffle]="q.shuffle"
          [questionAnswers]="q.answers"
          [correctAnswerIds]="correctIdsByQid.get(q.id ?? '') ?? testObs"
          [remotePass]="remotePass"
        ></quiz-radio>
      }
    }

    <div class="button-container">
      <button
        [disabled]="allowedAtts < 1 || isSubmitted || alreadyPassed"
        class="btn btn-success-outline submit-button"
        type="submit"
        (click)="submit()"
      >
        Submit
      </button>
      <button
        [disabled]="allowedAtts < 1 || !isSubmitted || alreadyPassed"
        class="btn btn-outline reset-button"
        (click)="reset()"
      >
        Retry
      </button>
    </div>
    @if(allowedAtts <= 100) {
      <span class="clr-subtext">Allowed attempts left: {{ allowedAtts }}</span> 
    }
  }
  @if(isPersistent && loadingQuestions && !started && !alreadyPassed && !loadingQuiz) {
    <div class="button-container">
      <button
        [disabled]="started || alreadyPassed || allowedAtts < 1"
        class="btn btn-success-outline submit-button"
        (click)="start(currentQuiz)"
      >
        Start
      </button>
    </div>
    @if(allowedAtts <= 100) {
      <span class="clr-subtext">Allowed attempts left: {{ allowedAtts }}</span> 
    }
  }
</pre>
